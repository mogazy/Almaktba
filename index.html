<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تطبيق الطلاب - جامعة النجف</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* الخط الرئيسي */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        /* حاوية المودال المخصص (لصناديق الرسائل) */
        .custom-modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .custom-modal-container.show {
            opacity: 1;
            visibility: visible;
        }

        .custom-modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            width: 500px; /* عرض ثابت للمودال */
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message-box-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            text-align: right; /* محاذاة العنوان لليمين */
        }

        .message-box-body {
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: right; /* محاذاة المحتوى لليمين */
        }

        .message-box-button {
            background: #4f46e5;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s ease;
            align-self: center; /* توسيط الزر */
        }

        .message-box-button:hover {
            background: #6d5ce7;
        }

        /* زر التحميل */
        .loading {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* لوحة الإدارة */
        .admin-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            display: none; /* مخفي افتراضياً */
            flex-direction: column;
            gap: 15px;
            text-align: right;
        }

        .admin-panel.show {
            display: flex;
        }

        .admin-panel input[type="text"],
        .admin-panel textarea {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            font-size: 14px;
            color: #333;
        }

        .admin-panel button {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }

        .admin-panel .add-btn {
            background-color: #4CAF50;
            color: white;
        }
        .admin-panel .add-btn:hover { background-color: #45a049; }

        .admin-panel .update-btn {
            background-color: #2196F3;
            color: white;
        }
        .admin-panel .update-btn:hover { background-color: #0b7dda; }

        .admin-panel .cancel-btn {
            background-color: #f44336;
            color: white;
        }
        .admin-panel .cancel-btn:hover { background-color: #da190b; }

        .lecture-item .admin-actions {
            display: flex;
            gap: 8px;
        }
        .lecture-item .admin-actions button {
            padding: 6px 10px;
            font-size: 12px;
            border-radius: 6px;
        }
        .lecture-item .admin-actions .edit-btn {
            background-color: #ff9800;
            color: white;
        }
        .lecture-item .admin-actions .edit-btn:hover { background-color: #e68a00; }

        .lecture-item .admin-actions .delete-btn {
            background-color: #f44336;
            color: white;
        }
        .lecture-item .admin-actions .delete-btn:hover { background-color: #da190b; }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-indigo-500 to-purple-600 min-h-screen text-gray-800 overflow-x: hidden;">
    <div class="app-container max-w-md mx-auto bg-white bg-opacity-95 backdrop-blur-xl min-h-screen relative shadow-2xl rounded-lg overflow-hidden md:min-h-0 md:my-8 md:rounded-xl">
        <header class="header flex justify-between items-center p-5 bg-gradient-to-tr from-indigo-600 to-purple-700 text-white relative overflow-hidden">
            <svg class="header-icon w-7 h-7 cursor-pointer transition-all duration-200 hover:scale-105 relative z-10" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
            
            <div class="logo-container text-center relative z-10">
                <div class="logo w-12 h-12 bg-gradient-to-br from-yellow-400 to-yellow-300 rounded-full flex items-center justify-center text-2xl font-bold text-indigo-700 mx-auto mb-1 shadow-lg">ج</div>
                <div class="app-title text-sm font-semibold opacity: 0.9;">جامعة النجف</div>
            </div>
            
            <div class="flex gap-3 items-center">
                <svg class="header-icon w-7 h-7 cursor-pointer transition-all duration-200 hover:scale-105 relative z-10" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                </svg>
                <div class="profile-pic w-9 h-9 rounded-full bg-gradient-to-br from-red-500 to-rose-600 flex items-center justify-center text-white font-bold cursor-pointer transition-all duration-200 hover:scale-105 relative z-10">أ</div>
            </div>
        </header>

        <main class="main-content p-6 pb-24">
            <div class="recent-lectures-section mb-6">
                <div id="lecturesList" class="lectures-list bg-white rounded-2xl p-5 shadow-lg">
                    <h2 class="section-title text-xl font-bold text-gray-800 pb-4 mb-5 text-right border-b border-gray-200">آخر المحاضرات</h2>
                    <div class="text-center text-gray-500 py-4" id="loadingLectures">جاري تحميل المحاضرات...</div>
                </div>
            </div>

            <div class="cards-grid grid grid-cols-2 gap-4 mb-6">
                <div class="feature-card bg-white p-5 rounded-2xl text-center cursor-pointer transition-all duration-200 shadow-lg hover:translate-y-[-3px] hover:shadow-xl relative overflow-hidden">
                    <div class="card-icon w-10 h-10 mx-auto mb-3 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-lg flex items-center justify-center text-lg text-white">📚</div>
                    <div class="card-title text-sm font-semibold text-gray-800 relative z-10">أحدث المحاضرات</div>
                </div>
                <div class="feature-card bg-white p-5 rounded-2xl text-center cursor-pointer transition-all duration-200 shadow-lg hover:translate-y-[-3px] hover:shadow-xl relative overflow-hidden">
                    <div class="card-icon w-10 h-10 mx-auto mb-3 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-lg flex items-center justify-center text-lg text-white">📅</div>
                    <div class="card-title text-sm font-semibold text-gray-800 relative z-10">جدول اليوم</div>
                </div>
                <div class="feature-card concept-explainer bg-white p-5 rounded-2xl text-center cursor-pointer transition-all duration-200 shadow-lg hover:translate-y-[-3px] hover:shadow-xl relative overflow-hidden">
                    <div class="card-icon w-10 h-10 mx-auto mb-3 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center text-lg text-white">💡</div>
                    <div class="card-title text-sm font-semibold text-gray-800 relative z-10">شرح المفاهيم ✨</div>
                </div>
                <div class="feature-card bg-white p-5 rounded-2xl text-center cursor-pointer transition-all duration-200 shadow-lg hover:translate-y-[-3px] hover:shadow-xl relative overflow-hidden">
                    <div class="card-icon w-10 h-10 mx-auto mb-3 bg-gradient-to-br from-indigo-600 to-purple-700 rounded-lg flex items-center justify-center text-lg text-white">🏆</div>
                    <div class="card-title text-sm font-semibold text-gray-800 relative z-10">الدرجات</div>
                </div>
            </div>

            <div class="translation-section mb-6 grid grid-cols-1 gap-4">
                <div class="translation-input-card bg-gradient-to-br from-cyan-500 to-blue-700 text-white p-5 rounded-2xl relative overflow-hidden">
                    <h3 class="mb-4 text-base font-semibold">إدخال النص للترجمة</h3>
                    <textarea id="translationInput" class="w-full p-3 border-none rounded-xl mb-4 text-sm bg-white bg-opacity-90 backdrop-blur-md text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-300 min-h-[100px]" placeholder="اكتب النص للترجمة..."></textarea>
                    <button id="translateBtn" class="bg-white bg-opacity-20 border-2 border-white border-opacity-30 text-white px-6 py-2 rounded-full cursor-pointer font-bold transition-all duration-200 backdrop-blur-md hover:bg-opacity-30">ترجم الآن</button>
                </div>
                <div class="translation-output-card bg-white p-5 rounded-2xl shadow-lg relative overflow-hidden">
                    <h3 class="mb-4 text-base font-semibold text-gray-800">النص المترجم</h3>
                    <div id="translatedTextDisplay" class="p-3 bg-gray-50 rounded-lg text-sm text-gray-700 text-right min-h-[100px] overflow-auto border border-gray-200">
                        </div>
                </div>
            </div>

            <!-- لوحة الإدارة -->
            <div id="adminPanel" class="admin-panel">
                <h2 class="section-title text-xl font-bold text-gray-800 pb-4 mb-5 text-right border-b border-gray-200">إدارة المحاضرات</h2>
                <input type="hidden" id="lectureDocId"> <!-- حقل مخفي لتخزين معرف المستند للتعديل -->

                <div class="mb-3">
                    <label for="lectureNameInput" class="block text-sm font-medium text-gray-700 mb-1">اسم المحاضرة:</label>
                    <input type="text" id="lectureNameInput" placeholder="أدخل اسم المحاضرة" required>
                </div>
                <div class="mb-3">
                    <label for="lecturerInput" class="block text-sm font-medium text-gray-700 mb-1">المحاضر:</label>
                    <input type="text" id="lecturerInput" placeholder="أدخل اسم المحاضر" required>
                </div>
                <div class="mb-3">
                    <label for="dateInput" class="block text-sm font-medium text-gray-700 mb-1">التاريخ (مثال: اليوم 2:30 م):</label>
                    <input type="text" id="dateInput" placeholder="أدخل التاريخ أو الوقت" required>
                </div>
                <div class="mb-4">
                    <label for="statusInput" class="block text-sm font-medium text-gray-700 mb-1">الحالة:</label>
                    <input type="text" id="statusInput" placeholder="متاح / غير متاح" required>
                </div>

                <div class="flex justify-center gap-4">
                    <button id="addLectureBtn" class="add-btn px-6 py-2">إضافة محاضرة جديدة</button>
                    <button id="updateLectureBtn" class="update-btn px-6 py-2 hidden">تحديث المحاضرة</button>
                    <button id="cancelEditBtn" class="cancel-btn px-6 py-2 hidden">إلغاء التعديل</button>
                </div>
            </div>
        </main>
    </div>

    <div class="custom-modal-container" id="customModalContainer">
        <div class="custom-modal-content" id="customModalContent">
            </div>
    </div>

    <button id="toggleAdminPanelBtn" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-blue-600 text-white py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-200 z-50">إظهار لوحة الإدارة</button>

    <script type="module">
        // استيراد وظائف Firebase المطلوبة
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";


        // Firebase Configuration (تم تحديثها من Firebase Console)
        const firebaseConfig = {
            apiKey: "AIzaSyA85E5iXbpE_Y2VFh2SHC4G5l7wUkh7_Eg",
            authDomain: "almktbh.firebaseapp.com",
            projectId: "almktbh",
            storageBucket: "almktbh.firebasestorage.app",
            messagingSenderId: "506817404401",
            appId: "1:506817404401:web:a826b307ab0fcb72a7f850", // تأكد أن هذا هو appId الصحيح لمشروعك
            measurementId: "G-MXNQL6JT3J"
        };
        const appId = firebaseConfig.appId; // الآن appId يأتي مباشرة من firebaseConfig

        // تهيئة Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const analytics = getAnalytics(app); // تهيئة Google Analytics
        let userId = null; // سيتم تحديثه بعد المصادقة

        // تعريف عناصر DOM الخاصة بلوحة الإدارة
        const adminPanel = document.getElementById('adminPanel');
        const lectureNameInput = document.getElementById('lectureNameInput');
        const lecturerInput = document.getElementById('lecturerInput');
        const dateInput = document.getElementById('dateInput');
        const statusInput = document.getElementById('statusInput');
        const lectureDocId = document.getElementById('lectureDocId');
        const addLectureBtn = document.getElementById('addLectureBtn');
        const updateLectureBtn = document.getElementById('updateLectureBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const toggleAdminPanelBtn = document.getElementById('toggleAdminPanelBtn');

        // وظيفة لفتح مودال مخصص بمحتوى ديناميكي (بديل لـ alert)
        function openCustomModal(title, contentHtml) {
            const container = document.getElementById('customModalContainer');
            const modalContentDiv = document.getElementById('customModalContent');

            modalContentDiv.innerHTML = `
                <div class="message-box-title">${title}</div>
                <div class="message-box-body">${contentHtml}</div>
                <button class="message-box-button" id="customModalCloseButton">موافق</button>
            `;
            container.classList.add('show');

            document.getElementById('customModalCloseButton').onclick = () => {
                closeCustomModal();
            };
            container.onclick = (e) => {
                if (e.target === container) {
                    closeCustomModal();
                }
            };
        }

        // وظيفة لإغلاق المودال المخصص
        function closeCustomModal() {
            const container = document.getElementById('customModalContainer');
            container.classList.remove('show');
            document.getElementById('customModalContent').innerHTML = ''; 
        }

        // وظيفة لعرض صندوق رسائل بسيط
        function showMessageBox(title, message) {
            openCustomModal(title, `<div class="message-box-content">${message}</div>`);
        }

        // وظيفة لمعالجة شرح المفهوم باستخدام Gemini API (محاكاة فقط)
        async function explainConcept() {
            const conceptInput = document.getElementById('conceptInput');
            const conceptText = conceptInput.value.trim();
            const explainBtn = document.getElementById('explainConceptBtn');
            const resultDisplay = document.getElementById('conceptResult');

            if (!conceptText) {
                showMessageBox('خطأ', 'الرجاء إدخال مفهوم لشرحه.');
                return;
            }

            explainBtn.textContent = 'جاري الشرح...';
            explainBtn.classList.add('loading'); // إضافة فئة التحميل
            explainBtn.disabled = true;
            resultDisplay.textContent = 'جاري المعالجة...'; // عرض رسالة تحميل

            try {
                // هذا الجزء هو للمحاكاة فقط في هذا الكود. API Key هنا فارغ.
                // في تطبيق حقيقي مع Gemini API، ستحتاج إلى مفتاح API صالح هنا.
                // بما أن الهدف هو وظائف Firebase، فإن هذا الجزء لا يؤثر على مشكلة جلب المحاضرات.
                const apiKey = ""; // سيتم توفير مفتاح API بواسطة Canvas تلقائيًا (في بيئة Google Classroom مثلاً)
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                // محاكاة استجابة Gemini API
                setTimeout(() => {
                    resultDisplay.textContent = 'هذه وظيفة لشرح المفاهيم. في تطبيق متكامل، سيتم استخدام نموذج ذكاء اصطناعي (مثل Gemini) هنا لشرح مفهوم "' + conceptText + '".';
                    explainBtn.textContent = 'شرح المفهوم ✨';
                    explainBtn.classList.remove('loading');
                    explainBtn.disabled = false;
                }, 1500);

            } catch (error) {
                console.error("خطأ في شرح المفهوم:", error);
                resultDisplay.textContent = 'حدث خطأ أثناء الشرح. الرجاء المحاولة مرة أخرى.';
                explainBtn.textContent = 'شرح المفهوم ✨';
                explainBtn.classList.remove('loading');
                explainBtn.disabled = false;
            }
        }

        // وظيفة لمسح حقول نموذج المحاضرة وإعادة ضبط الأزرار
        function clearLectureForm() {
            lectureNameInput.value = '';
            lecturerInput.value = '';
            dateInput.value = '';
            statusInput.value = '';
            lectureDocId.value = ''; // مسح معرف المستند المخفي
            addLectureBtn.classList.remove('hidden');
            updateLectureBtn.classList.add('hidden');
            cancelEditBtn.classList.add('hidden');
        }

        // وظيفة ملء النموذج ببيانات المحاضرة للتعديل
        function populateEditForm(lecture) {
            lectureNameInput.value = lecture.name || '';
            lecturerInput.value = lecture.lecturer || '';
            dateInput.value = lecture.date || '';
            statusInput.value = lecture.status || '';
            lectureDocId.value = lecture.id; // تخزين معرف المستند
            addLectureBtn.classList.add('hidden');
            updateLectureBtn.classList.remove('hidden');
            cancelEditBtn.classList.remove('hidden');
            // التمرير إلى لوحة الإدارة
            adminPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // دالة إضافة محاضرة إلى Firestore
        async function addLectureToFirestore() {
            const name = lectureNameInput.value.trim();
            const lecturer = lecturerInput.value.trim();
            const date = dateInput.value.trim();
            const status = statusInput.value.trim();

            if (!name || !lecturer || !date || !status) {
                showMessageBox('خطأ', 'الرجاء ملء جميع حقول المحاضرة.');
                return;
            }

            try {
                await addDoc(collection(db, 'lectures'), {
                    name,
                    lecturer,
                    date,
                    status,
                    timestamp: new Date() // إضافة ختم زمني للفرز
                });
                showMessageBox('نجاح', 'تمت إضافة المحاضرة بنجاح!');
                clearLectureForm();
                await fetchLecturesFromFirestore(); // إعادة تحميل القائمة
            } catch (error) {
                console.error("خطأ في إضافة المحاضرة:", error);
                showMessageBox('خطأ', 'فشل إضافة المحاضرة: ' + error.message);
            }
        }

        // دالة تحديث محاضرة في Firestore
        async function updateLectureInFirestore() {
            const docId = lectureDocId.value;
            const name = lectureNameInput.value.trim();
            const lecturer = lecturerInput.value.trim();
            const date = dateInput.value.trim();
            const status = statusInput.value.trim();

            if (!docId || !name || !lecturer || !date || !status) {
                showMessageBox('خطأ', 'الرجاء ملء جميع حقول المحاضرة ومعرف المستند.');
                return;
            }

            try {
                await updateDoc(doc(db, 'lectures', docId), {
                    name,
                    lecturer,
                    date,
                    status
                });
                showMessageBox('نجاح', 'تم تحديث المحاضرة بنجاح!');
                clearLectureForm();
                await fetchLecturesFromFirestore(); // إعادة تحميل القائمة
            } catch (error) {
                console.error("خطأ في تحديث المحاضرة:", error);
                showMessageBox('خطأ', 'فشل تحديث المحاضرة: ' + error.message);
            }
        }

        // دالة حذف محاضرة من Firestore
        async function deleteLectureFromFirestore(docId) {
            openCustomModal('تأكيد الحذف', `هل أنت متأكد أنك تريد حذف هذه المحاضرة؟
                <div class="flex justify-around mt-4">
                    <button id="confirmDeleteBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">نعم، احذف</button>
                    <button id="cancelDeleteBtn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors">إلغاء</button>
                </div>
            `);

            document.getElementById('confirmDeleteBtn').onclick = async () => {
                closeCustomModal();
                try {
                    await deleteDoc(doc(db, 'lectures', docId));
                    showMessageBox('نجاح', 'تم حذف المحاضرة بنجاح!');
                    await fetchLecturesFromFirestore(); // إعادة تحميل القائمة
                } catch (error) {
                    console.error("خطأ في حذف المحاضرة:", error);
                    showMessageBox('خطأ', 'فشل حذف المحاضرة: ' + error.message);
                }
            };
            document.getElementById('cancelDeleteBtn').onclick = () => {
                closeCustomModal();
            };
        }


        // دالة جلب وعرض المحاضرات من Firebase Firestore
        async function fetchLecturesFromFirestore() {
            const lecturesListDiv = document.getElementById('lecturesList');
            const loadingLectures = document.getElementById('loadingLectures');
            
            // مسح المحتوى الحالي باستثناء العنوان
            lecturesListDiv.innerHTML = '<h2 class="section-title text-xl font-bold text-gray-800 pb-4 mb-5 text-right border-b border-gray-200">آخر المحاضرات</h2>';
            // إضافة رسالة التحميل
            lecturesListDiv.appendChild(loadingLectures);

            try {
                // الانتظار حتى تتم المصادقة
                if (!userId) {
                    await signInAnonymously(auth); 
                    userId = auth.currentUser.uid;
                    console.log("تم تسجيل الدخول كمستخدم مجهول. معرف المستخدم:", userId);
                }
                
                // جلب البيانات من Cloud Firestore من مجموعة 'lectures' مباشرة
                const lecturesCol = collection(db, 'lectures'); 
                // نستخدم 'timestamp' للفرز الزمني. تأكد من وجود حقل timestamp في مستنداتك.
                const q = query(lecturesCol, orderBy('timestamp', 'desc')); 
                const lectureSnapshot = await getDocs(q);
                const lecturesData = lectureSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                // إزالة رسالة التحميل
                if (loadingLectures) {
                    loadingLectures.remove();
                }

                if (lecturesData.length === 0) {
                    lecturesListDiv.innerHTML += '<div class="text-center text-gray-500 py-4">لا توجد محاضرات متاحة حالياً في قاعدة البيانات.</div>';
                    return;
                }

                lecturesData.forEach((lecture, index) => {
                    const lectureItem = document.createElement('div');
                    lectureItem.classList.add(
                        'lecture-item', 'flex', 'justify-between', 'items-center', 'py-4',
                        'cursor-pointer', 'transition-all', 'duration-200', 'hover:bg-indigo-50',
                        'hover:mx-[-20px]', 'hover:px-5', 'hover:rounded-xl'
                    );

                    // أضف border-b ما لم تكن العنصر الأخير
                    if (index < lecturesData.length - 1) {
                        lectureItem.classList.add('border-b', 'border-gray-100');
                    }

                    lectureItem.innerHTML = `
                        <div class="lecture-info flex-1 text-right">
                            <div class="lecture-name text-base font-semibold text-gray-800 mb-1">${lecture.name || 'اسم المحاضرة غير متوفر'}</div>
                            <div class="lecture-details text-sm text-gray-600">${lecture.lecturer || 'غير معروف'} • ${lecture.date || 'غير معروف'}</div>
                        </div>
                        <div class="admin-actions flex items-center"> <!-- أزرار الإدارة -->
                            <button class="edit-btn px-2 py-1 ml-2 text-xs rounded-md" data-id="${lecture.id}">تعديل</button>
                            <button class="delete-btn px-2 py-1 text-xs rounded-md" data-id="${lecture.id}">حذف</button>
                            <div class="lecture-status available px-4 py-2 rounded-full text-xs font-semibold bg-gradient-to-br from-emerald-500 to-green-600 text-white">${lecture.status || 'متاح'}</div>
                        </div>
                    `;
                    
                    // ربط الأحداث لأزرار التعديل والحذف
                    const editButton = lectureItem.querySelector('.edit-btn');
                    editButton.addEventListener('click', (event) => {
                        event.stopPropagation(); // منع تشغيل حدث النقر على عنصر المحاضرة
                        populateEditForm(lecture);
                    });

                    const deleteButton = lectureItem.querySelector('.delete-btn');
                    deleteButton.addEventListener('click', (event) => {
                        event.stopPropagation(); // منع تشغيل حدث النقر على عنصر المحاضرة
                        deleteLectureFromFirestore(lecture.id);
                    });

                    // حدث النقر على عنصر المحاضرة (بخلاف أزرار الإدارة)
                    lectureItem.addEventListener('click', function() {
                        showMessageBox('فتح محاضرة', `فتح محاضرة: ${lecture.name || 'غير معروف'}`);
                    });

                    lecturesListDiv.appendChild(lectureItem);
                });

            } catch (error) {
                console.error("خطأ في جلب المحاضرات من Firebase:", error);
                lecturesListDiv.innerHTML += `<div class="text-center text-red-500 py-4">فشل تحميل المحاضرات من Firebase. الرجاء التأكد من إعداد مشروع Firebase الخاص بك، وأن Cloud Firestore مفعّل، وأن قاعدة البيانات تحتوي على مجموعة 'lectures' في الجذر مباشرةً بقواعد أمان تسمح بالقراءة للجميع. تفاصيل الخطأ: ${error.message}.</div>`;
            }
        }


        document.addEventListener('DOMContentLoaded', function() {
            const featureCards = document.querySelectorAll('.feature-card');
            const translateBtn = document.getElementById('translateBtn'); 
            const translationInput = document.getElementById('translationInput'); 
            const translatedTextDisplay = document.getElementById('translatedTextDisplay'); 
            const headerIcons = document.querySelectorAll('.header-icon, .profile-pic');
            
            // استدعاء دالة جلب المحاضرات من Firebase عند تحميل الصفحة
            fetchLecturesFromFirestore();

            // ربط أحداث أزرار لوحة الإدارة
            addLectureBtn.addEventListener('click', addLectureToFirestore);
            updateLectureBtn.addEventListener('click', updateLectureInFirestore);
            cancelEditBtn.addEventListener('click', clearLectureForm);

            // تبديل رؤية لوحة الإدارة
            toggleAdminPanelBtn.addEventListener('click', () => {
                adminPanel.classList.toggle('show');
                if (adminPanel.classList.contains('show')) {
                    toggleAdminPanelBtn.textContent = 'إخفاء لوحة الإدارة';
                } else {
                    toggleAdminPanelBtn.textContent = 'إظهار لوحة الإدارة';
                    clearLectureForm(); // مسح النموذج عند إخفاء اللوحة
                }
            });

            // تأثير النقر على بطاقات الميزات
            featureCards.forEach(card => {
                card.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                    const cardTitle = this.querySelector('.card-title').textContent;
                    if (!this.classList.contains('concept-explainer')) { 
                         showMessageBox('الوصول إلى الميزة', `تم الوصول إلى ميزة: ${cardTitle}`);
                    } else {
                        const conceptExplainerContent = `
                            <textarea id="conceptInput" class="w-full p-3 border border-gray-300 rounded-xl mb-4 text-sm bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-300" placeholder="اكتب المفهوم الذي تريد شرحه..."></textarea>
                            <button id="explainConceptBtn" class="bg-indigo-600 text-white px-6 py-2 rounded-full cursor-pointer font-bold transition-all duration-200 hover:bg-indigo-700 active:scale-95">شرح المفهوم ✨</button>
                            <div id="conceptResult" class="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-gray-700 text-right min-h-[50px] overflow-auto"></div>
                        `;
                        openCustomModal('شرح المفاهيم', conceptExplainerContent);
                        document.getElementById('explainConceptBtn').addEventListener('click', explainConcept);
                    }
                });
            });

            // وظيفة الترجمة (محاكاة بدون API)
            translateBtn.addEventListener('click', async function() {
                const text = translationInput.value.trim();
                if (!text) {
                    showMessageBox('خطأ', 'الرجاء إدخال نص للترجمة.');
                    return;
                }

                this.textContent = 'جاري الترجمة...';
                setTimeout(() => {
                    this.textContent = 'ترجم الآن';
                    translatedTextDisplay.textContent = 'هذا نص مترجم (محاكاة). النص الأصلي كان: "' + text + '"';
                }, 1500);
            });

            // تأثير النقر على أيقونات الرأس
            headerIcons.forEach(icon => {
                icon.addEventListener('click', function() {
                    this.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 100);
                    const isProfile = this.classList.contains('profile-pic');
                    const message = isProfile ? 'فتح الملف الشخصي' : 'فتح البحث/الإشعارات';
                    showMessageBox('وظيفة الرأس', message);
                });
            });
        });
    </script>
</body>
</html>

